<?php
	session_start();
	if (!isset($_SESSION['username'])) {
    	header("location: login.php");
    	exit();
	}
	$username = $_SESSION['username'];
?>

<!DOCTYPE html>
<html lang="en">
<head>
	<title> The Game || Let's Play </title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="css/game.css"></link>
</head>
<body>
	<?php
		if (!isset($_GET['newPR'])) { // Fetching highestScore from DB
			include('includes/dbh.inc.php');
			$sql = "SELECT * FROM login WHERE username='$username';";
			$result = mysqli_query($conn, $sql);
			$row = mysqli_fetch_array($result, MYSQLI_ASSOC);
			$pr = $row['highestScore'];
		}
		else {
			$pr = $_GET['newPR'];
			echo "<script>alert('Congratulations! A new Personal Record!');</script>";
		}
	?>
	

	<h5 class="to-be-blurred" style="display: inline; float:left; color: rgb(150,0,0); margin-left: 20px"> Hello,
		<span style="font-size:20px"><?php echo $username;?>! </span>Personal Record: <?php echo $pr;?> </h5>
	<h5 class="to-be-blurred" style="display: inline; float:right; line-height: 11px; margin-right: 40px"><a href=includes/logout.inc.php> Log out </a></h5>

	<button class="to-be-blurred" id="start-btn" type="button" onclick=newRound()> START! </button>
	<div>
		<span id=timer-image></span>
		<span id=timer-text>50</span>
	</div>

	<button id=hf-btn class="to-be-blurred" type="button" onclick=halloFame() style="position: absolute; top: 40%; left: 3%;"> HALL of FAME </button>
	<div id=hall-of-fame hidden>
        <h1 style="text-align: center; color: rgb(150,0,0); font-size: 40px; letter-spacing: 6px"> HALL of FAME </h1>
		<table id=tbl>
			<tr>
				<th>Player</th>
				<th>Score</th>
			</tr>
			<tr>
				<td id="username-st"></td>
				<td id="score-st"></td>
			</tr>
			<tr>
				<td id="username-nd"></td>
				<td id="score-nd"></td>
			</tr>
			<tr id="third">
				<td id="username-rd"></td>
				<td id="score-rd"></td>
			</tr>
			<caption><button id=dis-btn type="button" onclick=hideHalloFame()> DISMISS </button></caption>
		</table>
	</div>

	<button id="winner" type="button" onclick=increment() hidden style="position: absolute; top: 25%; left: 44%;"> KEEP GOING! </button>
	<h4 class="to-be-blurred" id="score" style="position: absolute; top: 44%; left: 45%;"> Your Score: 0 </h4>


	<!-- Hidden forms for making requests -->
	<form name="sendingScore" action="includes/updating-scores.inc.php" method="GET" hidden>
        <input type="text" name="username" value="<?php echo $_SESSION['username'];?>">
        <input type="text" name="personalRecord" value="<?php echo $pr;?>">
        <input type="text" name="score">
        <input type="submit">
    </form>
    <form name="requestingHalloFame" action="includes/updating-hall-of-fame.inc.php" method="GET" hidden>
        <input type="text" name="username" value="<?php echo $_SESSION['username'];?>">
        <input type="submit">
    </form>



	<script type="text/javascript" src="main.js"></script>
	<?php
    	if (isset($_GET['one'])) {
			echo "<script>blur()</script>";
			echo "<script>document.getElementById('username-st').innerHTML='".$_GET['one']."'</script>";
			echo "<script>document.getElementById('score-st').innerHTML='".$_GET['one_s']."'</script>";
		}
		if (isset($_GET['two'])) {
			echo "<script>document.getElementById('username-nd').innerHTML='".$_GET['two']."'</script>";
			echo "<script>document.getElementById('score-nd').innerHTML='".$_GET['two_s']."'</script>";
		}
		if (isset($_GET['three'])) {
			echo "<script>document.getElementById('username-rd').innerHTML='".$_GET['three']."'</script>";
			echo "<script>document.getElementById('score-rd').innerHTML='".$_GET['three_s']."'</script>";
		}
    ?>
</body>
</html>